import{c as oe,a as N,n as ee,v as be,p as K,V as X,W as ye,N as Ie,O as Pe,i as M,t as A,g as ie,r as Z,u as se,m as O,P as xe,H as Ce,I as Y,L as Se,e as q,w as re,y as ce,o as Te,M as ue,j as De,f as Fe,l as ke}from"./index-ddc2bfca.js";import{B as ze}from"./index-b5a9ee24.js";import{I as de}from"./index-4a8931cd.js";/* empty css              */import{S as Re,a as Ve}from"./index-2925adf5.js";import{_ as Ae}from"./RadioBtn-b63dfdfa.js";import"./index-c446ce8d.js";import{F as Le}from"./index-f62330f2.js";import{_ as Be}from"./CpNavBar-1aee6368.js";import{_ as Ue}from"./avatar-doctor-206a2b5c.js";import{C as j}from"./index-a80f6987.js";import{u as Ze}from"./consult-dff14eb7.js";/* empty css              */import{u as Oe}from"./consult-7f7ba8f9.js";import{b as Xe}from"./index-a7e87634.js";import{v as Ne}from"./runtime-dom.esm-bundler-2ec6e87b.js";import{L as me,u as ve}from"./index-e78eca4d.js";import{c as Me,P as Ye,m as Ee,u as $e,s as Q}from"./request-24c768a8.js";import{L as H,z as te,u as $,I as U,y as E,N as n,X as He,G as We,a2 as ae,a0 as je,a3 as Ge,o as qe,P as Ke,Q as P,T as Qe,S as Je,a7 as eo,K as oo,r as to,V as ao,W as so,_ as no}from"./_plugin-vue_export-helper-f3904dc0.js";import{c as fe}from"./interceptor-8f4f549c.js";import"./use-route-5b103eac.js";import"./on-popup-reopen-04aacf57.js";import"./use-id-bbaed4f6.js";import"./use-placeholder-79bf5db6.js";const ne=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),J=oe("image-preview")[1];var lo=H({props:{src:String,show:Boolean,active:Number,minZoom:N(ee),maxZoom:N(ee),rootWidth:N(Number),rootHeight:N(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:t,slots:c}){const o=te({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=Me(),w=$(),x=U(()=>{const{rootWidth:s,rootHeight:m}=e,g=m/s;return o.imageRatio>g}),C=U(()=>{const{scale:s,moveX:m,moveY:g,moving:T,zooming:V}=o,W={transitionDuration:V||T?"0s":".3s"};if(s!==1){const we=m/s,_e=g/s;W.transform=`scale(${s}, ${s}) translate(${we}px, ${_e}px)`}return W}),y=U(()=>{if(o.imageRatio){const{rootWidth:s,rootHeight:m}=e,g=x.value?m/o.imageRatio:s;return Math.max(0,(o.scale*g-s)/2)}return 0}),i=U(()=>{if(o.imageRatio){const{rootWidth:s,rootHeight:m}=e,g=x.value?m:s*o.imageRatio;return Math.max(0,(o.scale*g-m)/2)}return 0}),f=s=>{s=X(s,+e.minZoom,+e.maxZoom+1),s!==o.scale&&(o.scale=s,t("scale",{scale:s,index:e.active}))},d=()=>{f(1),o.moveX=0,o.moveY=0},r=()=>{const s=o.scale>1?1:2;f(s),o.moveX=0,o.moveY=0};let p,D,F,k,z,u,_,a=!1;const v=s=>{const{touches:m}=s;if(p=m.length,p===2&&e.disableZoom)return;const{offsetX:g}=l;l.start(s),D=o.moveX,F=o.moveY,_=Date.now(),a=!1,o.moving=p===1&&o.scale!==1,o.zooming=p===2&&!g.value,o.zooming&&(k=o.scale,z=ne(s.touches))},I=s=>{const{touches:m}=s;if(l.move(s),o.moving){const{deltaX:g,deltaY:T}=l,V=g.value+D,W=T.value+F;if((V>y.value||V<-y.value)&&!a){o.moving=!1;return}a=!0,K(s,!0),o.moveX=X(V,-y.value,y.value),o.moveY=X(W,-i.value,i.value)}if(o.zooming&&(K(s,!0),m.length===2)){const g=ne(m),T=k*g/z;f(T)}},b=()=>{if(p>1)return;const{offsetX:s,offsetY:m}=l,g=Date.now()-_,T=250,V=5;s.value<V&&m.value<V&&(g<T?u?(clearTimeout(u),u=null,r()):u=setTimeout(()=>{t("close"),u=null},T):g>ye&&t("longPress"))},S=s=>{let m=!1;(o.moving||o.zooming)&&(m=!0,o.moving&&D===o.moveX&&F===o.moveY&&(m=!1),s.touches.length||(o.zooming&&(o.moveX=X(o.moveX,-y.value,y.value),o.moveY=X(o.moveY,-i.value,i.value),o.zooming=!1),o.moving=!1,D=0,F=0,k=1,o.scale<1&&d(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),K(s,m),b(),l.reset()},R=s=>{const{naturalWidth:m,naturalHeight:g}=s.target;o.imageRatio=g/m};return E(()=>e.active,d),E(()=>e.show,s=>{s||d()}),be("touchmove",I,{target:U(()=>{var s;return(s=w.value)==null?void 0:s.$el})}),()=>{const s={loading:()=>n(me,{type:"spinner"},null)};return n(Re,{ref:w,class:J("swipe-item"),onTouchstartPassive:v,onTouchend:S,onTouchcancel:S},{default:()=>[c.image?n("div",{class:J("image-wrap")},[c.image({src:e.src})]):n(de,{src:e.src,fit:"contain",class:J("image",{vertical:x.value}),style:C.value,onLoad:R},s)]})}}});const[io,B]=oe("image-preview"),ro=["show","teleport","transition","overlayStyle","closeOnPopstate"],co={show:Boolean,loop:A,images:ie(),minZoom:Z(1/3),maxZoom:Z(3),overlay:A,closeable:Boolean,showIndex:A,className:se,closeIcon:O("clear"),transition:String,beforeClose:Function,overlayClass:se,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:A,closeIconPosition:O("top-right"),teleport:[String,Object]};var ge=H({name:io,props:co,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:t,slots:c}){const o=$(),l=te({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(o.value){const u=xe(o.value.$el);l.rootWidth=u.width,l.rootHeight=u.height,o.value.resize()}},x=u=>t("scale",u),C=u=>t("update:show",u),y=()=>{fe(e.beforeClose,{args:[l.active],done:()=>C(!1)})},i=u=>{u!==l.active&&(l.active=u,t("change",u))},f=()=>{if(e.showIndex)return n("div",{class:B("index")},[c.index?c.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},d=()=>{if(c.cover)return n("div",{class:B("cover")},[c.cover()])},r=()=>{l.disableZoom=!0},p=()=>{l.disableZoom=!1},D=()=>n(Ve,{ref:o,lazyRender:!0,loop:e.loop,class:B("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:i,onDragEnd:p,onDragStart:r},{default:()=>[e.images.map((u,_)=>n(lo,{src:u,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,onScale:x,onClose:y,onLongPress:()=>t("longPress",{index:_})},{image:c.image}))]}),F=()=>{if(e.closeable)return n(Y,{role:"button",name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),Ce],onClick:y},null)},k=()=>t("closed"),z=(u,_)=>{var a;return(a=o.value)==null?void 0:a.swipeTo(u,_)};return ve({swipeTo:z}),He(w),E([Ie,Pe],w),E(()=>e.startPosition,u=>i(+u)),E(()=>e.show,u=>{const{images:_,startPosition:a}=e;u?(i(+a),We(()=>{w(),z(+a,{immediate:!0})})):t("close",{index:l.active,url:_[l.active]})}),()=>n(Ye,ae({class:[B(),e.className],overlayClass:[B("overlay"),e.overlayClass],onClosed:k,"onUpdate:show":C},M(e,ro)),{default:()=>[F(),D(),f(),d()]})}});let G;const uo={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function mo(){({instance:G}=Ee({setup(){const{state:e,toggle:t}=$e(),c=()=>{e.images=[]};return()=>n(ge,ae(e,{onClosed:c,"onUpdate:show":t}),null)}}))}const vo=(e,t=0)=>{if(Se)return G||mo(),e=Array.isArray(e)?{images:e,startPosition:t}:e,G.open(q({},uo,e)),G};re(ge);const[fo,h,go]=oe("uploader");function le(e,t){return new Promise(c=>{if(t==="file"){c();return}const o=new FileReader;o.onload=l=>{c(l.target.result)},t==="dataUrl"?o.readAsDataURL(e):t==="text"&&o.readAsText(e)})}function pe(e,t){return ce(e).some(c=>c.file?Te(t)?t(c.file):c.file.size>t:!1)}function po(e,t){const c=[],o=[];return e.forEach(l=>{pe(l,t)?o.push(l):c.push(l)}),{valid:c,invalid:o}}const ho=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i,wo=e=>ho.test(e);function he(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?wo(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var _o=H({props:{name:ee,item:N(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:t,slots:c}){const o=()=>{const{status:i,message:f}=e.item;if(i==="uploading"||i==="failed"){const d=i==="failed"?n(Y,{name:"close",class:h("mask-icon")},null):n(me,{class:h("loading")},null),r=De(f)&&f!=="";return n("div",{class:h("mask")},[d,r&&n("div",{class:h("mask-message")},[f])])}},l=i=>{const{name:f,item:d,index:r,beforeDelete:p}=e;i.stopPropagation(),fe(p,{args:[d,{name:f,index:r}],done:()=>t("delete")})},w=()=>t("preview"),x=()=>{if(e.deletable&&e.item.status!=="uploading"){const i=c["preview-delete"];return n("div",{role:"button",class:h("preview-delete",{shadow:!i}),tabindex:0,"aria-label":go("delete"),onClick:l},[i?i():n(Y,{name:"cross",class:h("preview-delete-icon")},null)])}},C=()=>{if(c["preview-cover"]){const{index:i,item:f}=e;return n("div",{class:h("preview-cover")},[c["preview-cover"](q({index:i},f))])}},y=()=>{const{item:i,lazyLoad:f,imageFit:d,previewSize:r}=e;return he(i)?n(de,{fit:d,src:i.content||i.url,class:h("preview-image"),width:Array.isArray(r)?r[0]:r,height:Array.isArray(r)?r[1]:r,lazyLoad:f,onClick:w},{default:C}):n("div",{class:h("file"),style:ue(e.previewSize)},[n(Y,{class:h("file-icon"),name:"description"},null),n("div",{class:[h("file-name"),"van-ellipsis"]},[i.file?i.file.name:i.url]),C()])};return()=>n("div",{class:h("preview")},[y(),o(),x()])}});const bo={name:Z(""),accept:O("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:Z(1/0),imageFit:O("cover"),resultType:O("dataUrl"),uploadIcon:O("photograph"),uploadText:String,deletable:A,afterRead:Function,showUpload:A,modelValue:ie(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:A,previewOptions:Object,previewFullImage:A,maxSize:{type:[Number,String,Function],default:1/0}};var yo=H({name:fo,props:bo,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:t,slots:c}){const o=$(),l=[],w=(a=e.modelValue.length)=>({name:e.name,index:a}),x=()=>{o.value&&(o.value.value="")},C=a=>{if(x(),pe(a,e.maxSize))if(Array.isArray(a)){const v=po(a,e.maxSize);if(a=v.valid,t("oversize",v.invalid,w()),!a.length)return}else{t("oversize",a,w());return}a=te(a),t("update:modelValue",[...e.modelValue,...ce(a)]),e.afterRead&&e.afterRead(a,w())},y=a=>{const{maxCount:v,modelValue:I,resultType:b}=e;if(Array.isArray(a)){const S=+v-I.length;a.length>S&&(a=a.slice(0,S)),Promise.all(a.map(R=>le(R,b))).then(R=>{const s=a.map((m,g)=>{const T={file:m,status:"",message:""};return R[g]&&(T.content=R[g]),T});C(s)})}else le(a,b).then(S=>{const R={file:a,status:"",message:""};S&&(R.content=S),C(R)})},i=a=>{const{files:v}=a.target;if(e.disabled||!v||!v.length)return;const I=v.length===1?v[0]:[].slice.call(v);if(e.beforeRead){const b=e.beforeRead(I,w());if(!b){x();return}if(ke(b)){b.then(S=>{y(S||I)}).catch(x);return}}y(I)};let f;const d=()=>t("closePreview"),r=a=>{if(e.previewFullImage){const v=e.modelValue.filter(he),I=v.map(b=>(b.file&&!b.url&&b.status!=="failed"&&(b.url=URL.createObjectURL(b.file),l.push(b.url)),b.url)).filter(Boolean);f=vo(q({images:I,startPosition:v.indexOf(a),onClose:d},e.previewOptions))}},p=()=>{f&&f.close()},D=(a,v)=>{const I=e.modelValue.slice(0);I.splice(v,1),t("update:modelValue",I),t("delete",a,w(v))},F=(a,v)=>{const I=["imageFit","deletable","previewSize","beforeDelete"],b=q(M(e,I),M(a,I,!0));return n(_o,ae({item:a,index:v,onClick:()=>t("clickPreview",a,w(v)),onDelete:()=>D(a,v),onPreview:()=>r(a)},M(e,["name","lazyLoad"]),b),M(c,["preview-cover","preview-delete"]))},k=()=>{if(e.previewImage)return e.modelValue.map(F)},z=a=>t("clickUpload",a),u=()=>{if(e.modelValue.length>=e.maxCount)return;const a=e.readonly?null:n("input",{ref:o,type:"file",class:h("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:i},null);return c.default?n("div",{class:h("input-wrapper"),onClick:z},[c.default(),a]):Ge(n("div",{class:h("upload",{readonly:e.readonly}),style:ue(e.previewSize),onClick:z},[n(Y,{name:e.uploadIcon,class:h("upload-icon")},null),e.uploadText&&n("span",{class:h("upload-text")},[e.uploadText]),a]),[[Ne,e.showUpload]])},_=()=>{o.value&&!e.disabled&&o.value.click()};return je(()=>{l.forEach(a=>URL.revokeObjectURL(a))}),ve({chooseFile:_,closeImagePreview:p}),Fe(()=>e.modelValue),()=>n("div",{class:h()},[n("div",{class:h("wrapper",{disabled:e.disabled})},[k(),u()])])}});const Io=re(yo);const L=e=>(ao("data-v-7526d06e"),e=e(),so(),e),Po={class:"consult-illness-page"},xo={class:"illness-tip van-hairline--bottom"},Co=L(()=>P("img",{class:"img",src:Ue},null,-1)),So={class:"info"},To=L(()=>P("p",{class:"tit"},"在线医生",-1)),Do=L(()=>P("p",{class:"tip"}," 请描述你的疾病或症状、是否用药、就诊经历，需要我听过什么样的帮助 ",-1)),Fo={class:"safe"},ko=L(()=>P("span",null,"内容仅医生可见",-1)),zo={class:"illness-form"},Ro={class:"item"},Vo=L(()=>P("p",null,"本次患病多久了？",-1)),Ao={class:"item"},Lo=L(()=>P("p",null,"此次病情是否去医院就诊过？",-1)),Bo={class:"illness-img"},Uo=L(()=>P("p",{class:"tip"},"上传内容仅医生可见,最多9张图,最大5MB",-1)),Zo=H({__name:"ConsultIllnewss",setup(e){const t=$({illnessDesc:"",illnessTime:void 0,consultFlag:void 0,pictures:[]}),c=[{label:"一周内",value:j.week},{label:"一月内",value:j.mounth},{label:"半年内",value:j.halfYear},{label:"半年以上",value:j.more}],o=[{label:"就诊过",value:1},{label:"没就诊",value:0}],l=async d=>{var r;if(!Array.isArray(d)&&d.file){d.status="uploading",d.message="上传中...";try{const p=await Ze(d.file);d.status="done",d.url=p.data.url,(r=t.value.pictures)==null||r.push(p.data),console.log(p)}catch{d.status="failed",d.message="上传失败"}}},w=$([]),x=d=>{var r;t.value.pictures=(r=t.value.pictures)==null?void 0:r.filter(p=>p.url!==d.url)},C=U(()=>!(t.value.illnessDesc&&t.value.illnessTime&&t.value.consultFlag!==void 0)),y=Oe(),i=Xe(),f=()=>{if(!t.value.illnessDesc)return Q("请输入病情描述");if(t.value.illnessTime===void 0)return Q("请输入病情时间");if(t.value.consultFlag===void 0)return Q("请选择是否就诊过");y.setIllnessDesc(t.value),i.push("/user/patient?ischange=1")};return(d,r)=>{const p=Be,D=to("cp-icon"),F=Le,k=Ae,z=Io,u=ze;return qe(),Ke("div",Po,[n(p,{title:"图文问诊"}),P("div",xo,[Co,P("div",So,[To,Do,P("p",Fo,[n(D,{name:"consult-safe"}),ko])])]),P("div",zo,[n(F,{type:"textarea",rows:"3",placeholder:"请详细描述您的病情，病情描述不能为空",modelValue:t.value.illnessDesc,"onUpdate:modelValue":r[0]||(r[0]=_=>t.value.illnessDesc=_)},null,8,["modelValue"]),P("div",Ro,[Vo,n(k,{options:c,modelValue:t.value.illnessTime,"onUpdate:modelValue":r[1]||(r[1]=_=>t.value.illnessTime=_)},null,8,["modelValue"])]),P("div",Ao,[Lo,n(k,{options:o,modelValue:t.value.consultFlag,"onUpdate:modelValue":r[2]||(r[2]=_=>t.value.consultFlag=_)},null,8,["modelValue"])]),P("div",Bo,[n(z,{"after-read":l,multiple:"","max-count":"9","max-size":5*1024*1024,"upload-icon":"upgrade","upload-text":"上传图片",modelValue:w.value,"onUpdate:modelValue":r[3]||(r[3]=_=>w.value=_),onDelete:x},null,8,["modelValue"]),Uo]),n(u,{onClick:f,class:eo({disabled:oo(C)}),type:"primary",block:"",round:""},{default:Qe(()=>[Je("下一步")]),_:1},8,["class"])])])}}});const ct=no(Zo,[["__scopeId","data-v-7526d06e"]]);export{ct as default};
