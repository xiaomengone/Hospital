import{w as Q}from"./index-ddc2bfca.js";/* empty css              */import{s as T,A as H,a as Y,b as Z}from"./index-b668b031.js";import{B as G}from"./index-b5a9ee24.js";import{C as j}from"./index-be667d0b.js";import"./index-c446ce8d.js";import{F as ee}from"./index-f62330f2.js";import{_ as te}from"./index-4f697cc1.js";import{_ as ae}from"./CpNavBar-1aee6368.js";import{g as ne,e as re,b as oe,d as se}from"./user-0d9278d7.js";import{_ as le}from"./RadioBtn-b63dfdfa.js";import{a as ie,b as ue}from"./index-a7e87634.js";import{u as ce}from"./consult-7f7ba8f9.js";import{P as de,s as N,a as R}from"./request-24c768a8.js";import{L as fe,u as O,X as pe,I as M,o as b,P as V,N as c,K as A,a5 as D,Q as _,U as ve,a6 as _e,T as P,S as E,A as W,c as he,a7 as me,R as U,V as ge,W as ye,_ as be}from"./_plugin-vue_export-helper-f3904dc0.js";import{F as ke}from"./index-3181e814.js";import"./runtime-dom.esm-bundler-2ec6e87b.js";import"./use-placeholder-79bf5db6.js";import"./on-popup-reopen-04aacf57.js";import"./index-e78eca4d.js";import"./use-route-5b103eac.js";import"./interceptor-8f4f549c.js";import"./use-id-bbaed4f6.js";Q(T);var $={},we={get exports(){return $},set exports(m){$=m}};(function(m){(function(k){var g=typeof window<"u",y=g?window:this;m.exports?m.exports=k(g,y):y.IDValidator=k(g,y)})(function(k,g){var y={error:{longNumber:"长数字存在精度问题，请使用字符串传值！ Long number is not allowed, because the precision of the Number In JavaScript."}},a={checkArg:function(e,t){var n=typeof e;switch(n){case"number":if(e=e.toString(),e.length>15)return this.error(y.error.longNumber),!1;break;case"string":break;default:return!1}if(e=e.toUpperCase(),t&&!isNaN(t)&&(t=parseInt(t),e.length!==t))return!1;var r=null;if(e.length===18)r={body:e.slice(0,17),checkBit:e.slice(-1),type:18};else if(e.length===15)r={body:e,type:15};else return!1;return r},checkAddr:function(e,t){var n=this.getAddrInfo(e,t);return n!==!1},getAddrInfo:function(e,t){if(t=t||null,t===null)return e;if(t.hasOwnProperty(e))return t[e];var n;return n=e.slice(0,4)+"00",t.hasOwnProperty(n)?t[n]+"未知地区":(n=e.slice(0,2)+"0000",t.hasOwnProperty(n)?t[n]+"未知地区":!1)},checkBirth:function(e){var t,n;if(e.length==8)parseInt(e.slice(0,4),10),t=parseInt(e.slice(4,6),10),n=parseInt(e.slice(-2),10);else if(e.length==6)parseInt("19"+e.slice(0,2),10),t=parseInt(e.slice(2,4),10),n=parseInt(e.slice(-2),10);else return!1;return!(t>12||t===0||n>31||n===0)},checkOrder:function(e){return!0},weight:function(e){return Math.pow(2,e-1)%11},rand:function(e,t){return t=t||1,Math.round(Math.random()*(e-t))+t},str_pad:function(e,t,n,r){if(e=e.toString(),t=t||2,n=n||"0",r=r||!1,e.length>=t)return e;for(var f=0,u=t-e.length;f<u;f++)r?e=e+n:e=n+e;return e},error:function(e){var t=new Error;throw t.message="IDValidator: "+e,t}},S=function(e){typeof e<"u"&&(this.GB2260=e),this.cache={}};return S.prototype={isValid:function(e,t){var n=this.GB2260||null,r=a.checkArg(e,t);if(r===!1)return!1;if(this.cache.hasOwnProperty(e)&&typeof this.cache[e].valid<"u")return this.cache[e].valid;this.cache.hasOwnProperty(e)||(this.cache[e]={});var f=r.body.slice(0,6),u=r.type===18?r.body.slice(6,14):r.body.slice(6,12),h=r.body.slice(-3);if(!(a.checkAddr(f,n)&&a.checkBirth(u)&&a.checkOrder(h)))return this.cache[e].valid=!1,!1;if(r.type===15)return this.cache[e].valid=!0,!0;for(var i=[],p=18;p>1;p--){var x=a.weight(p);i[p]=x}for(var w=0,I=r.body.split(""),l=0;l<I.length;l++)w+=parseInt(I[l],10)*i[18-l];var o=12-w%11;return o==10?o="X":o>10&&(o=o%11),o=typeof o=="number"?o.toString():o,o!==r.checkBit?(this.cache[e].valid=!1,!1):(this.cache[e].valid=!0,!0)},getInfo:function(e,t){var n=this.GB2260||null;if(this.isValid(e,t)===!1)return!1;var r=a.checkArg(e);if(typeof this.cache[e].info<"u")return this.cache[e].info;var f=r.body.slice(0,6),u=r.type===18?r.body.slice(6,14):r.body.slice(6,12),h=r.body.slice(-3),i={};return i.addrCode=f,n!==null&&(i.addr=a.getAddrInfo(f,n)),i.birth=r.type===18?[u.slice(0,4),u.slice(4,6),u.slice(-2)].join("-"):["19"+u.slice(0,2),u.slice(2,4),u.slice(-2)].join("-"),i.sex=h%2===0?0:1,i.length=r.type,r.type===18&&(i.checkBit=r.checkBit),this.cache[e].info=i,i},makeID:function(e){var t=this.GB2260||null,n=null;if(t!==null)for(var r=0;n===null;){if(r>10){n=110101;break}var f=a.str_pad(a.rand(50),2,"0"),u=a.str_pad(a.rand(20),2,"0"),h=a.str_pad(a.rand(20),2,"0"),i=[f,u,h].join("");if(t[i]){n=i;break}}else n=110101;var p=a.str_pad(a.rand(99,50),2,"0"),x=a.str_pad(a.rand(12,1),2,"0"),w=a.str_pad(a.rand(28,1),2,"0");if(e)return n+p+x+w+a.str_pad(a.rand(999,1),3,"1");p="19"+p;for(var I=n+p+x+w+a.str_pad(a.rand(999,1),3,"1"),l=[],o=18;o>1;o--){var F=a.weight(o);l[o]=F}for(var C=0,B=I.split(""),v=0;v<B.length;v++)C+=parseInt(B[v],10)*l[18-v];var d=12-C%11;return d==10?d="X":d>10&&(d=d%11),d=typeof d=="number"?d.toString():d,I+d}},S})})(we);const Ie=$,L=m=>(ge("data-v-0732bfd6"),m=m(),ye(),m),Ce={class:"patient-page"},Ve={key:0,class:"patient-change"},Pe=L(()=>_("h3",null,"请选择患者信息",-1)),xe=L(()=>_("p",null,"以便医生给出更准确的治疗，信息仅医生可见",-1)),Fe=[Pe,xe],Be={class:"patient-list"},Se=["onClick"],Ne={class:"info"},Ae={class:"name"},De={class:"id"},Oe={class:"icon"},Ue={key:0,class:"tag"},Le=L(()=>_("p",null,"添加患者",-1)),Re=L(()=>_("div",{class:"patient-tip"},"最多可添加 6 人",-1)),We={key:1,class:"patient-next"},$e=fe({__name:"FamilyPatient",setup(m){const k=O([]),g=async()=>{const l=await ne();k.value=l.data};pe(async()=>{g()});const y={name:"",idCard:"",gender:1,defaultFlag:0};let a=O(!1);const S=l=>{if(l){const{id:o,idCard:F,name:C,gender:B,defaultFlag:v}=l;e.value={id:o,idCard:F,name:C,gender:B,defaultFlag:v}}else e.value={...y};a.value=!0},e=O({...y}),t=M({get(){return e.value.defaultFlag===1},set(l){e.value.defaultFlag=l?1:0}}),n=[{label:"女",value:0},{label:"男",value:1}],r=async()=>{if(!e.value.name)return N("请输入姓名");if(!e.value.idCard)return N("请输入身份证号");const l=new Ie;if(!l.isValid(e.value.idCard))return N("身份证号不合法");if(l.getInfo(e.value.idCard).sex!==e.value.gender)return N("性别与身份证不符");e.value.id?(await re(e.value),a.value=!1,g(),R("修改成功")):(await oe(e.value),a.value=!1,g(),R("添加成功"))},f=async()=>{await Z({title:"标题",message:"确定删除吗。"}),await se(e.value.id),a.value=!1,g(),R("删除成功")},u=ie(),h=M(()=>u.query.ischange==="1"),i=O(),p=l=>{h.value&&(i.value=l.id)},x=ce(),w=ue(),I=()=>{if(!i.value)return N("请选择一个患者");x.setPatient(i.value),w.push("/consult/pay")};return(l,o)=>{const F=ae,C=te,B=G,v=ee,d=j,X=ke,z=H,q=Y,J=de;return b(),V("div",Ce,[c(F,{title:A(h)?"选择患者":"家庭档案"},null,8,["title"]),A(h)?(b(),V("div",Ve,Fe)):D("",!0),_("div",Be,[(b(!0),V(ve,null,_e(k.value,s=>(b(),V("div",{class:me(["patient-item",{selected:i.value===s.id}]),key:s.id,onClick:K=>p(s)},[_("div",Ne,[_("span",Ae,U(s.name),1),_("span",De,U(s.idCard.replace(/^(.{6})(?:\d+)(.{2})$/,"$1**********$2")),1),_("span",null,U(s.genderValue),1),_("span",null,U(s.age)+"岁",1)]),_("div",Oe,[c(C,{name:"user-edit",onClick:K=>S(s)},null,8,["onClick"])]),s.defaultFlag===1?(b(),V("div",Ue,"默认")):D("",!0)],10,Se))),128)),k.value.length<6?(b(),V("div",{key:0,class:"patient-add",onClick:o[0]||(o[0]=s=>S())},[c(C,{name:"user-add"}),Le])):D("",!0),Re]),A(h)?(b(),V("div",We,[c(B,{type:"primary",round:"",block:"",onClick:I},{default:P(()=>[E("下一步")]),_:1})])):D("",!0),c(J,{show:A(a),"onUpdate:show":o[5]||(o[5]=s=>W(a)?a.value=s:a=s),position:"right"},{default:P(()=>[c(F,{title:e.value.id?"编辑患者":"添加患者",back:()=>W(a)?a.value=!1:a=!1,"right-text":"保存",onClickRight:r},null,8,["title","back"]),c(X,{autocomplete:"off",ref:"form"},{default:P(()=>[c(v,{modelValue:e.value.name,"onUpdate:modelValue":o[1]||(o[1]=s=>e.value.name=s),label:"真实姓名",placeholder:"请输入真实姓名"},null,8,["modelValue"]),c(v,{modelValue:e.value.idCard,"onUpdate:modelValue":o[2]||(o[2]=s=>e.value.idCard=s),label:"身份证号",placeholder:"请输入身份证号"},null,8,["modelValue"]),c(v,{label:"性别",class:"pb4"},{input:P(()=>[c(le,{options:n,modelValue:e.value.gender,"onUpdate:modelValue":o[3]||(o[3]=s=>e.value.gender=s)},null,8,["modelValue"])]),_:1}),c(v,{label:"默认就诊人"},{input:P(()=>[c(d,{"icon-size":18,round:"",modelValue:A(t),"onUpdate:modelValue":o[4]||(o[4]=s=>W(t)?t.value=s:null)},null,8,["modelValue"])]),_:1})]),_:1},512),e.value.id?(b(),he(q,{key:0},{default:P(()=>[c(z,{onClick:f},{default:P(()=>[E("删除")]),_:1})]),_:1})):D("",!0)]),_:1},8,["show"])])}}});const ut=be($e,[["__scopeId","data-v-0732bfd6"]]);export{ut as default};
